
<!-- README.md is generated from README.Rmd. Please edit that file -->

# Review of Schools and Programmes of Public Health

<!-- badges: start -->

<!-- badges: end -->

This repository is a template for a
[`docker`](https://www.docker.com/get-started)-containerised,
[`{targets}`](https://docs.ropensci.org/targets/)-based,
[`{renv}`](https://rstudio.github.io/renv/articles/renv.html)-enabled
[`R`](https://cran.r-project.org/) workflow for the **Review of Schools
and Programmes of Public Health project**.

## About the Project

## Repository Structure

The project repository is structured as follows:

    spph-review
        |-- .github/
        |-- data/
        |-- data-raw/
        |-- figures/
        |-- outputs/
        |-- R/
        |-- renv
        |-- reports
        |-- _targets_analysis.R
        |-- _targets_data.R
        |-- _targets_output.R
        |-- _targets_rag.R
        |-- _targets_release.R
        |-- _targets.R
        |-- .Rprofile
        |-- packages.R
        |-- renv.lock

  - `.github` contains project testing and automated deployment of
    outputs workflows via continuous integration and continuous
    deployment (CI/CD) using Github Actions.

  - `data/` contains intermediate and final data outputs produced by the
    workflow.

  - `data-raw/` contains raw datasets, usually either downloaded from
    source or added manually, that are used in the project.

  - `figures/` contains figures produced by the workflow.

  - `outputs/` contains compiled reports produced by the workflow.

  - `R/` contains functions developed/created specifically for use in
    this workflow.

  - `renv/` contains `renv` package specific files and directories used
    by the package for maintaining R package dependencies within the
    project. The directory `renv/library`, is a library that contains
    all packages currently used by the project. This directory, and all
    files and sub-directories within it, are all generated and managed
    by the `renv` package. Users should not change/edit these manually.

  - `reports/` contains literate code for R Markdown and/or Quarto
    reports rendered in the workflow.

  - `_targets*.R` files define the steps in the workflow’s data ingest,
    data processing, data analysis, and reporting pipelines.

  - `.Rprofile` file is a project R profile generated when initiating
    `renv` for the first time. This file is run automatically every time
    R is run within this project, and `renv` uses it to configure the R
    session to use the `renv` project library.

  - `packages.R` file lists out all R package dependencies required by
    the workflow.

  - `renv.lock` file is the `renv` lockfile which records enough
    metadata about every package used in this project that it can be
    re-installed on a new machine. This file is generated by the `renv`
    package and should not be changed/edited manually.

## Reproducibility

### System dependencies

This project requires the following system dependencies:

  - `poppler`

This project depends on the
[`{pdftools}`](https://poppler.freedesktop.org/) package which requires
the `poppler` PDF rendering library to be installed first. For macOS and
Windows users, installation of `{pdftools}` via the binary packages
available from CRAN will deal with this requirement automatically.
However, for Linux users, the `poppler` library will need to be
installed first in order to be able to install `{pdftools}` from source.
Installation of the `poppler` library for Linux is described
[here](https://docs.ropensci.org/pdftools/#installation).

  - `quarto`

This project uses the [`quarto`](https://quarto.org/) open-source
scientific and technical publishing system. Instructions on how to
download and install `quarto` can be found
[here](https://quarto.org/docs/get-started/).

  - `ollama`

This project uses `ollama` to serve open large language modles (LLM)
locally. Instructions on how to download and install `ollama` can be
found [here](https://ollama.com/download). This project specifically
uses the open source `DeepSeek-R1` model. Once `ollama` is installed,
pull one of the `DeepSeek-R1` models that fits into your local machine.
The workflow has been developed and implemented using the
`deepseek-r1:671b` model which requires about 404GB of random access
memory (RAM). We would recommend using the same model where possible or
if your machine has enough memory resources.

### R package dependencies

This project was built using `R 4.5.1`. This project uses the `renv`
framework to record R package dependencies and versions. Packages and
versions used are recorded in `renv.lock` and code used to manage
dependencies is in `renv/` and other files in the root project
directory. After cloning this repository, start an R session in the
project’s working directory and then run

``` r
renv::restore()
```

to install all R package dependencies.

### Running the workflow

Currently, the project has workflows for the following:

1.  
2.  Extraction, transformation, and loading (ETL) workflow for the
    **Times Higher Education (THE)** university rankings, **QS** world
    university rankings, and the **ShanghaiRanking** academic ranking of
    world universities.

The following diagram illustrates this pipeline.

Warning: program compiled against libxml 213 using older 209 +
the\_rankings\_download\_files declared \[5 branches\] +
qs\_overall\_rankings\_download\_file declared \[5 branches\] +
the\_rankings\_pdf\_text declared \[5 branches\] +
qs\_overall\_rankings\_list declared \[5 branches\] +
the\_overall\_rankings declared \[5 branches\] + qs\_overall\_rankings
declared \[5 branches\]

``` mermaid
graph LR
  style Graph fill:#FFFFFF00,stroke:#000000;
  subgraph Graph
    direction LR
    xf5b5abed18ea1d1a(["qs_gdrive_id"]):::uptodate --> x6416e41cf8dc3821(["qs_gdrive_list"]):::uptodate
    xd53eac577d2929f8["qs_overall_rankings_list"]:::uptodate --> x37b9da1597241587["qs_overall_rankings"]:::uptodate
    x6416e41cf8dc3821(["qs_gdrive_list"]):::uptodate --> x10da32f41de863de["qs_overall_rankings_download_file"]:::uptodate
    x10da32f41de863de["qs_overall_rankings_download_file"]:::uptodate --> xd53eac577d2929f8["qs_overall_rankings_list"]:::uptodate
    x283ab20454910291(["sr_ph_rankings_gdrive_list"]):::uptodate --> xe2fef9f751519f5f(["sr_ph_rankings_download_file"]):::uptodate
    xf9bf18a76745f614(["sr_gdrive_id"]):::uptodate --> x283ab20454910291(["sr_ph_rankings_gdrive_list"]):::uptodate
    x74232ff4e76c1dcf(["sr_public_health_rankings_raw"]):::uptodate --> xa7027837a89e5ec4(["sr_public_health_rankings"]):::uptodate
    x1a5851e4bb9a8b0f(["wb_income_groups"]):::uptodate --> xa7027837a89e5ec4(["sr_public_health_rankings"]):::uptodate
    xa7027837a89e5ec4(["sr_public_health_rankings"]):::uptodate --> x40fa25b81086eaaf(["sr_public_health_rankings_csv"]):::outdated
    xe2fef9f751519f5f(["sr_ph_rankings_download_file"]):::uptodate --> x74232ff4e76c1dcf(["sr_public_health_rankings_raw"]):::uptodate
    x08954fb96f89d64e(["the_gdrive_id"]):::uptodate --> xb3b152c5e5e4ae89(["the_gdrive_ranking_download_links"]):::uptodate
    xac3c5bdc37f5521d["the_rankings_pdf_text"]:::uptodate --> x2a541b9a4da4732f["the_overall_rankings"]:::uptodate
    xb3b152c5e5e4ae89(["the_gdrive_ranking_download_links"]):::uptodate --> xcb7c43287b8b4747["the_rankings_download_files"]:::uptodate
    x91d62071178d9fcb(["the_rankings_pdf_pages"]):::uptodate --> xac3c5bdc37f5521d["the_rankings_pdf_text"]:::uptodate
    xcb7c43287b8b4747["the_rankings_download_files"]:::uptodate --> xac3c5bdc37f5521d["the_rankings_pdf_text"]:::uptodate
    x578811b318f92d03(["wb_income_download_file"]):::uptodate --> x1a5851e4bb9a8b0f(["wb_income_groups"]):::uptodate
    
  end
```

To run this workflow, issue the following command on the R console:

``` r
targets::tar_make(dplyr::starts_with(c("the", "qs", "sr")))
```
